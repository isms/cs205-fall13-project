<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="http://pages.github.com/favicon.ico">

    <title>CS 205 Final Project</title>

    <!-- Bootstrap core CSS -->
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/journal/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$']]}
      });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
  </head>

  <body>

    <div class="container">
      <div class="header">
        <ul class="nav nav-pills pull-right">
          <li><a href="index.html">Home</a></li>
          <li class="active"><a href="results.html">Results</a></li>
          <li><a href="https://github.com/isms/cs205-fall13-project" target="_blank"><img src="img/GitHub-Mark-32px.png" height="18"/> Code</a></li>
        </ul>
        <h3 class="text-muted">CS 205 Project</h3>
      </div>

      <div class="container">
        <h2>Parallelizing an ILP Assignment Problem</h2>
        <h3 class="text-muted">Results</h3>
      </div>

      <div class="row marketing">
        <div class="col-md-12">
          <h4>Setup</h4>

          <p>We modeled the underlying ILP with <code><a href="https://code.google.com/p/pulp-or/">pulp</a></code> using the <code><a href="http://www.gnu.org/software/glpk/">GNU GLPK</a></code> as the back-end solver. We used <code><a href="http://mpi4py.scipy.org/">mpi4py</a></code> to parallelize the implementation.</p>

          <h5>Notation</h5>

          <p>Let $m$ denote the number of students and $n$ denote the number of classes. Let $x_{ij}$ be a binary variable with $x_{ij} = 1$ indicating that student $i$ is assigned to class $j$, for $i = 1, ..., m$, $j = 1, ..., n$.</p>

          <h5>Objective function</h5>

          <p>Our true goal in the ILP is not to find the <i>best</i> solution &mdash; we evaluate solution fitness in the non-linear step &mdash; it is actually to generate as many feasible solutions as possible subject to our hard constraints. We create an arbitrary objective function based on student identification numbers:</p>

              <p style="text-align:center">
                 $\operatorname{min} Z = \sum_{j=1}^{n} \sum_{i=1}^{m} x_{ij} \cdot i \cdot j \quad \text{for } i \in \{1, ..., m\} \text{; } j \in \{1, ..., n\}$
              <p>

          <p>This objective function can be used to get the solver to generate a different feaible solution. Specifically, we can take the objective function minimum found in the last iteration &mdash; call it $z_{t-1}$ &mdash; and add a new constraint for the current iteration that the objective function $Z > z_{t-1}$.</p>

          <p><small><strong>Note:</strong> some solvers are able to generate additional feasible solutions from the same LP model, but many are not. Though we opted to use <code>GLPK</code> for benchmarking purposes, we wanted to avoid making assumptions about the solver. For that reason, we chose this method of an artificial objective function with iterative constraints in order to generate multiple feasible solutions.</small></p>

          <h5>Constraints</h5>

          <ol>
            <li> All decision variables must be binary.

                <p style="text-align:center">
                   $x_{ij} \in \{0, 1\} \quad \forall \; i \in \{1, ..., m\} \text{; } j \in \{1, ..., n\}$
                </p></li>

            <li>Every student must be assigned to a class.</p>

                <p style="text-align:center">
                   $\sum_{j=1}^{n} x_{ij} = 1 \quad \text{for } i \in \{1, ..., m\}$
                </p></li>

            <li>A maximum class size $k$ must be respected.</p>

                <p style="text-align:center">
                   $\sum_{i=1}^{m} x_{ij} \leq k \quad \text{for } j \in \{1, ..., n\}$
                </p></li>

            <li>Every student must be in a class with one of his or her designated friends (in a friend list $L_i$ of friends for student $i$).</p>

                <p style="text-align:center">
                   $x_{ij} \leq \sum_{s \in L_i} x_{sj} \quad \text{for } i \in \{1, ..., m\} \text{; } j \in \{1, ..., n\}$
                </p></li>

            <li>Certain other constraints involving the male/female ratio in a class, or students who should be kept apart.</li>
        </ol>

        <h4>Basic implementation</h4>

        <p>The simplest implementation using MPI is to start each process off with a roughly equal portion of the integers in between the absolute min and max of the artificial objective function, and simply work through that process without communicating further.</p>

        <p>The obvious problem with this method &mdash; we'll call it the "naive" implementation &mdash; is that some processors may finish long before the others and waste time doing nothing. Nonetheless, there is large initial win simply by dividing up the work among many processors. We seek to improve on this initial improvement by being smarter about keeping all processes employed.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/result-naive.png" width="600" />
          </div>
          <div class="panel-footer">Results from the naive implementation.</div>
        </div>

        <h4>Distributed load balancing</h4>

        <p>One way to split up work in MPI is to start each process off with a roughly equal amount of work (as in the naive implementation), but <strong>let them communicate directly with one another if they run out of work</strong>.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/distributed-load-balancing.png" width="600" />
          </div>
          <div class="panel-footer">Distributed load balancing.</div>
        </div>

        <p>With fewer processors, this was a relatively fast and efficient method. However, as the number of processes increases the overhead increases quickly. Part of the reason is that in order to avoid non-blocking communication, a process that runs out of work randomly picks a different process to ask for more. When there are many processes with relatively small search spaces, they all tend to run out fairly quickly and then spend too much time trying to contact one another before wrapping up.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <!-- <img src="img/result-distributed.png" width="600" /> -->
          </div>
          <div class="panel-footer">Results from the naive implementation.</div>
        </div>

        <h4>Master/slave model</h4>

        <p>In the first iteration of master/slave, <strong>each process gets an even chunk</strong> of the integers in between the absolute min and max of the artificial objective function. In this scheme, we do not yet do any load balancing. Although it seems probable that load balancing will have a net positive impact, we first would like to observe performance without doing so &mdash; this way we can quantify the benefits of load balancing, and see if the added overhead is worthwhile.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/mpi-master-slave.png" width="600" />
          </div>
          <div class="panel-footer">Master/slave using even work assignments for all processes.</div>
        </div>

        <p>Like distributed load balancing, this method resulted in excellent speedups over the serial version &mdash; the following graph shows both speedup and efficiency with different numbers of processors.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/result-no-split.png" width="600" />
          </div>
          <div class="panel-footer">Results from solving ILP with MPI master/slave.</div>
        </div>

        <h4>Master/slave model with load balancing</h4>

        <p>To be even more efficient, we don't want any of our slave processes to finish early (which they often do because feasible solutions are not evenly distributed through the space of integers being divided up). In our next iteration, we implemented a scheme where the master would attempt to <strong>redistribute work from the slowest process to any process that had finished</strong> all of its initial work assignment.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/mpi-splitting-work.png" width="600" />
          </div>
          <div class="panel-footer">Master/slave with load balancing to keep all processes employed.</div>
        </div>

        Load balancing was even faster (and slightly more efficient) than the previous implementation.

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/result-split.png" width="600" />
          </div>
          <div class="panel-footer">Results from solving ILP with MPI master/slave and load balancing.</div>
        </div>


        <h4>Table of results for master/slave</h4>

          <table class="table table-striped table-condensed">
            <thead>
              <tr>
                <th>processors</th>
                <th>load balancing</th>
                <th>time (s)</th>
                <th>speedup</th>
                <th>efficiency</th>
              </tr>
            </thead>
            <tbody>
              <tr class="warning">
                <td>   1</td>
                <td> ---</td>
                <td> 13500.3095</td>
                <td> ---</td>
                <td> ---</td>
              </tr>
              <tr>
                <td>   4</td>
                <td>  No</td>
                <td> 4922.5975</td>
                <td>   2.74</td>
                <td> 0.69</td>
              </tr>
              <tr>
                <td>   8</td>
                <td>  No</td>
                <td> 2212.6460</td>
                <td>   6.10</td>
                <td> 0.76</td>
              </tr>
              <tr>
                <td>  16</td>
                <td>  No</td>
                <td> 1148.0969</td>
                <td>  11.76</td>
                <td> 0.73</td>
              </tr>
              <tr>
                <td>  32</td>
                <td>  No</td>
                <td>  581.3491</td>
                <td>  23.22</td>
                <td> 0.73</td>
              </tr>
              <tr>
                <td>  64</td>
                <td>  No</td>
                <td>  325.5046</td>
                <td>  41.48</td>
                <td> 0.69</td>
              </tr>
              <tr>
                <td> 128</td>
                <td>  No</td>
                <td>  186.2928</td>
                <td>  72.49</td>
                <td> 0.57</td>
              </tr>
              <tr>
                <td> 256</td>
                <td>  No</td>
                <td>  161.1719</td>
                <td>  83.76</td>
                <td> 0.33</td>
              </tr>
              <tr>
                <td>   4</td>
                <td> Yes</td>
                <td> 4538.3395</td>
                <td>   2.97</td>
                <td> 0.74</td>
              </tr>
              <tr>
                <td>   8</td>
                <td> Yes</td>
                <td> 1965.5124</td>
                <td>   6.87</td>
                <td> 0.86</td>
              </tr>
              <tr>
                <td>  16</td>
                <td> Yes</td>
                <td>  961.8448</td>
                <td>  14.04</td>
                <td> 0.88</td>
              </tr>
              <tr>
                <td>  32</td>
                <td> Yes</td>
                <td>  481.9911</td>
                <td>  28.01</td>
                <td> 0.88</td>
              </tr>
              <tr>
                <td>  64</td>
                <td> Yes</td>
                <td>  300.3186</td>
                <td>  44.95</td>
                <td> 0.70</td>
              </tr>
              <tr>
                <td> 128</td>
                <td> Yes</td>
                <td>  179.7172</td>
                <td>  75.12</td>
                <td> 0.59</td>
              </tr>
              <tr>
                <td> 256</td>
                <td> Yes</td>
                <td>  130.6939</td>
                <td> 103.30</td>
                <td> 0.40</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="footer">
        <p>D. Newman, I. Slavitt, 2013</p>
      </div>

    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  </body>
</html>

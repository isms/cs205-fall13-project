<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png"> -->

    <title>CS 205 Final Project</title>

    <!-- Bootstrap core CSS -->
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/journal/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$']]}
      });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
  </head>

  <body>

    <div class="container">
      <div class="header">
        <ul class="nav nav-pills pull-right">
          <li><a href="index.html">Home</a></li>
          <li class="active"><a href="results.html">Results</a></li>
          <li><a href="https://github.com/isms/cs205-fall13-project" target="_blank"><img src="img/GitHub-Mark-32px.png" height="18"/> Code</a></li>
        </ul>
        <h3 class="text-muted">CS 205 Project</h3>
      </div>

      <div class="container">
        <h2>Parallelizing an ILP Assignment Problem</h2>
        <h3 class="text-muted">Results</h3>
      </div>

      <div class="row marketing">
        <div class="col-md-12">
          <h4>Setup</h4>

          <p>We modeled the underlying ILP with <code><a href="https://code.google.com/p/pulp-or/">pulp</a></code> using the <code><a href="http://www.gnu.org/software/glpk/">GNU GLPK</a></code> as the back-end solver. We used <code><a href="http://mpi4py.scipy.org/">mpi4py</a></code> to parallelize the implementation.</p>

          <h5>Notation</h5>

          <p>Let $m$ denote the number of students and $n$ denote the number of classes. Let $x_{ij}$ be a binary variable with $x_{ij} = 1$ indicating that student $i$ is assigned to class $j$, for $i = 1, ..., m$, $j = 1, ..., n$.</p>

          <h5>Objective Function</h5>

          <p>Our true goal in the ILP is not to find the <i>best</i> solution &mdash; we evaluate solution fitness in the non-linear step &mdash; it is actually to generate as many feasible solutions as possible subject to our hard constraints. We create an arbitrary objective function based on student identification numbers:</p>

              <p style="text-align:center">
                 $\operatorname{min} Z = \sum_{j=1}^{n} \sum_{i=1}^{m} x_{ij} \cdot i \cdot j \quad \text{for } i \in \{1, ..., m\} \text{; } j \in \{1, ..., n\}$
              <p>

          <p>This objective function can be used to get the solver to generate a different feaible solution. Specifically, we can take the objective function minimum found in the last iteration &mdash; call it $z_{t-1)$ &mdash; and add a new constraint for the current iteration that the objective function $Z \geq z_{t-1)$.</p>

          <p><strong>Note:</strong> some solvers are able to generate additional feasible solutions from the same LP model, but many are not. Though we opted to use <code>GLPK</code> for benchmarking purposes, we wanted to avoid making assumptions about the solver. For that reason, we chose this method of an artificial objective function with iterative constraints in order to generate multiple feasible solutions.</p>

          <h5>Constraints</h5>

          <ol>
            <li> All decision variables must be binary.

                <p style="text-align:center">
                   $x_{ij} \in \{0, 1\} \quad \forall \; i \in \{1, ..., m\} \text{; } j \in \{1, ..., n\}$
                </p></li>

            <li>Every student must be assigned to a class.</p>

                <p style="text-align:center">
                   $\sum_{j=1}^{n} x_{ij} = 1 \quad \text{for } i \in \{1, ..., m\}$
                </p></li>

            <li>A maximum class size $k$ must be respected.</p>

                <p style="text-align:center">
                   $\sum_{i=1}^{m} x_{ij} \leq k \quad \text{for } j \in \{1, ..., n\}$
                </p></li>

            <li>Every student must be in a class with one of his or her designated friends (in a friend list $L_i$ of friends for student $i$).</p>

                <p style="text-align:center">
                   $x_{ij} \leq \sum_{s \in L_i} x_{sj} \quad \text{for } i \in \{1, ..., m\} \text{; } j \in \{1, ..., n\}$
                </p></li>

            <li>Certain other constraints involving the male/female ratio in a class, or students who should be kept apart.</li>
        </ol>

        <h4>Master/Slave model in MPI</h4>

        <p>In the first implementation, <b>each process gets an even chunk</b> of the integers in between the absolute min and max of the artificial objective function.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/mpi-master-slave.png" width="600" />
          </div>
          <div class="panel-footer">Using even work assignments for all processes.</div>
        </div>

        <p>This method generated impressive speedups -- the following graph shows both speedup and efficiency with different numbers of processors.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/result-no-split.png" width="600" />
          </div>
          <div class="panel-footer">Results from solving ILP with MPI master/slave.</div>
        </div>

        <h4>Splitting up the work</h4>

        <p>To be even more efficient, we don't want any of our slave processes to finish early, which they often do because feasible solutions are not evenly distributed through the space of integers being divided up. In our next iteration, we implemented a scheme where the master would attempt to <b>redistribute work from the slowest process to any process that had finished</b> all of its initial work assignment.</p>

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/mpi-splitting-work.png" width="600" />
          </div>
          <div class="panel-footer">Splitting work to keep all processes employed.</div>
        </div>

        Work splitting was even faster (and slightly more efficient) than the previous implementation.

        <div class="panel panel-default">
          <div class="panel-body">
            <img src="img/result-split.png" width="600" />
          </div>
          <div class="panel-footer">Results from solving ILP with MPI master/slave with work splitting.</div>
        </div>


        <h4>Table of results</h4>

          <table class="table table-striped table-condensed">
            <thead>
              <tr>
                <th>processors</th>
                <th>split work?</th>
                <th>time (s)</th>
                <th>speedup</th>
                <th>efficiency</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>   4</td>
                <td>  No</td>
                <td> 4922.5975</td>
                <td>   2.742517</td>
                <td> 0.685629</td>
              </tr>
              <tr>
                <td>   8</td>
                <td>  No</td>
                <td> 2212.6460</td>
                <td>   6.101432</td>
                <td> 0.762679</td>
              </tr>
              <tr>
                <td>  16</td>
                <td>  No</td>
                <td> 1148.0969</td>
                <td>  11.758859</td>
                <td> 0.734929</td>
              </tr>
              <tr>
                <td>  32</td>
                <td>  No</td>
                <td>  581.3491</td>
                <td>  23.222380</td>
                <td> 0.725699</td>
              </tr>
              <tr>
                <td>  64</td>
                <td>  No</td>
                <td>  325.5046</td>
                <td>  41.475019</td>
                <td> 0.648047</td>
              </tr>
              <tr>
                <td> 128</td>
                <td>  No</td>
                <td>  186.2928</td>
                <td>  72.468230</td>
                <td> 0.566158</td>
              </tr>
              <tr>
                <td> 256</td>
                <td>  No</td>
                <td>  161.1719</td>
                <td>  83.763420</td>
                <td> 0.327201</td>
              </tr>
              <tr>
                <td>   4</td>
                <td> Yes</td>
                <td> 4538.3395</td>
                <td>   2.974724</td>
                <td> 0.743681</td>
              </tr>
              <tr>
                <td>   8</td>
                <td> Yes</td>
                <td> 1965.5124</td>
                <td>   6.868595</td>
                <td> 0.858574</td>
              </tr>
              <tr>
                <td>  16</td>
                <td> Yes</td>
                <td>  961.8448</td>
                <td>  14.035850</td>
                <td> 0.877241</td>
              </tr>
              <tr>
                <td>  32</td>
                <td> Yes</td>
                <td>  481.9911</td>
                <td>  28.009458</td>
                <td> 0.875296</td>
              </tr>
              <tr>
                <td>  64</td>
                <td> Yes</td>
                <td>  300.3186</td>
                <td>  44.953291</td>
                <td> 0.702395</td>
              </tr>
              <tr>
                <td> 128</td>
                <td> Yes</td>
                <td>  179.7172</td>
                <td>  75.119741</td>
                <td> 0.586873</td>
              </tr>
              <tr>
                <td> 256</td>
                <td> Yes</td>
                <td>  130.6939</td>
                <td> 103.297166</td>
                <td> 0.403505</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="footer">
        <p>D. Newman, I. Slavitt, 2013</p>
      </div>

    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  </body>
</html>
